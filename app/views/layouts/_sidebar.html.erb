<div class="d-flex flex-column flex-shrink-0 p-3 bg-light" style="width: 280px;">
  <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
    <svg class="bi pe-none me-2" width="40" height="32"><use xlink:href="#bootstrap"></use></svg>
    <span class="fs-5">Filters</span>
  </a>
  <hr>

  <div class="form-row d-flex mb-1">
    <div class="form-group col-12">
      <div class="d-block">
        <input name="add_tag" class="form-control" id="tag-select" placeholder="Filter by tag">
      </div>
    </div>
  </div>

  <div>
    <% session[:tags_to_filter].each do |tag| %>
      <span
        style="cursor: pointer;"
        data-tagname="<%= tag %>"
        class="badge bg-secondary tag-remove"><%= tag %> <span class="fw-lighter text-decoration-underline">x</span></span>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  $("#tag-select").autocomplete({
    source: <%= current_user.tags.map { |tag| tag.name }.to_s.html_safe %>,
    select: function(event, ui) {
      $.ajax({
        url: "/",
        data: {add_tag: ui.item.value}
      }).always(function() {
        window.location.reload();
      });
    }
  });

  $(".tag-remove").click(function(event) {
    $.ajax({
        url: "/",
        data: {remove_tag: event.target.dataset.tagname}
      }).always(function() {
        window.location.reload();
      });
  });
</script>
